# Contract Audit Report (Task 3)

## Contracts & Functions
{% for c in flows.contracts %}
### {{ c.name }}
- Events: {% for e in c.events %}{{e.name}}{{ ", " if not loop.last }}{% endfor %}
- Functions:
{% for f in c.functions %}
  - **{{ f.name }}** (visibility: {{ f.visibility or "n/a" }}, mutability: {{ f.mutability or "n/a" }})
    - inputs: {% for i in f.inputs %}{{ i.type }} {{ i.name }}{{ ", " if not loop.last }}{% endfor %}
{% endfor %}
{% endfor %}

## Findings (Slither)
{% set static_path = outdir ~ '/runs/static/slither.normalized.json' %}
{% set findings = [] %}
{% if (static_path | safe) %}{% endif %}
(See HTML report for a richer table.)

## Risk Overview

**Overall:** {{ "%.1f"|format(risk_summary.overall if risk_summary else 0) }}
{% if risk_summary and 'delta_overall' in risk_summary and risk_summary.delta_overall != 0 -%}
 (Δ {{ "%.1f"|format(risk_summary.delta_overall) }})
{%- endif %}  
**Grade:** {{ risk_summary.grade if risk_summary else "N/A" }}

{% if risk_summary and risk_summary.buckets %}
**Risk Profile:** {% for grade, count in risk_summary.buckets.items() %}{% if count > 0 %}`{{ grade }}: {{ count }}` {% endif %}{% endfor %}
{% endif %}

{% if risk_trend %}
**Risk Trend:** Latest: **{{ "%.1f"|format(risk_trend.meta.latest) }}**, Window: **{{ risk_trend.meta.count }}** (min **{{ "%.1f"|format(risk_trend.meta.min) }}**, max **{{ "%.1f"|format(risk_trend.meta.max) }}**)
_See HTML report for inline sparkline._
{% endif %}

### Top 10 Risky Functions
{% if risk and risk.summary.top_functions %}
| # | Function | Score | Δ | Grade |
|---|---|---:|---:|---|
{% for item in risk.summary.top_functions -%}
| {{ loop.index }} | `{{ item.key }}` | {{ "%.1f"|format(item.score) }} | {{ "%.1f"|format(risk.by_function[item.key].delta if risk and risk.by_function and item.key in risk.by_function and 'delta' in risk.by_function[item.key] else 0.0) }} | {{ item.grade }} |
{% endfor %}
{% else %}No high-risk functions identified.{% endif %}

### Risk Heatmap (compact)
{% if risk_heatmap and risk_heatmap|length > 0 %}
| Contract | Function | Score | Δ | Grade | STRIDE |
|---|---|---:|---:|---|---|
{% for row in risk_heatmap -%}
| {{ row.contract }} | `{{ row.function }}` | {{ "%.1f"|format(row.score) }} | {{ "%.1f"|format(row.delta if row.delta is defined else 0.0) }} | {{ row.grade }} | {{ row.cats|join(", ") }} |
{% endfor %}
{% else %}No risk data available.{% endif %}

## Test Results
(See HTML report for detailed table.)

## Top Gas
(See HTML report for the full table.)

## EoP Coverage
(See HTML report for detailed table.)

## LLM Assertions
{% if not llm_meta.enabled %}
LLM disabled ({{ llm_meta.reason or 'off' }}).
{% else %}
Provider: `{{ llm_meta.provider }}`  Model: `{{ llm_meta.model }}`

Artifacts: {{ llm_rows|length }} (see HTML for details)

LLM summary: added {{ llm_stats.added }}, skipped {{ llm_stats.skipped }}, error {{ llm_stats.error }}.
{% endif %}
